<!DOCTYPE html>
<html lang="PT-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="assets/styles/global.css" />
    <link rel="stylesheet" href="assets/styles/toannounce.css" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Space+Grotesk%3Awght%40400%3B500%3B700"
    />
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="/core/app.js"></script>
    <title>JDM Motors</title>
  </head>
  <body>
    <header>
      <div class="logo">
        <a href="index.html">
          <img src="assets/imgs/logo.png" />
        </a>
        <a href="index.html"> <span>JDM</span> Motors </a>
      </div>
      <div>
        <nav>
          <ul>
            <a href="toannounce.html">Anunciar</a>
          </ul>
          <ul>
            <a href="peace.html">Peças</a>
          </ul>
          <ul>
            <a href="cars.html">Carros</a>
          </ul>
          <ul>
            <a href="contactus.html">Contato</a>
          </ul>
          <ul id="logout-ul">
            <a href="login.html">Perfil</a>
          </ul>
          <ul class="hidden" id="login-ul">
            <a onClick="goToProfile()"><div class="div-img-header"><img src="/assets/imgs/login.jpg"></div></a>
          
        </nav>
      </div>
    </header>

    <section class="main-announce">
      <div id="logged-in" class="hidden">
        <h1>ANUNCIAR</h1>
        <form id="carForm">
          <label>Título do anúncio:</label>
          <input
            type="text"
            name="announceName"
            placeholder="Digite o título do anúncio"
            required
          />

          <label>Ano de fabricação do Veículo:</label>
          <input
            type="number"
            name="year"
            placeholder="Digite o ano do produto"
            required
          />

          <label>Detalhes:</label>
          <input
            type="text"
            name="details"
            placeholder="Digite os detalhes do veículo"
          />

          <label>Preço:</label>
          <input
            type="number"
            name="price"
            placeholder="Digite o preço do produto"
            required
          />

          <label>Descrição do produto:</label>
          <textarea
            name="desc"
            placeholder="Descreva o produto que deseja anunciar"
            required
          ></textarea>

          <div id="img-announce" class="hidden">
            <label for="fileInput"> <span>+</span> Selecione uma imagem</label>
            <input name="img" type="file" id="fileInput" multiple />
          </div>

          <button type="submit">Anunciar</button>
        </form>
      </div>

      <div id="desc-announce" class="hidden">
        <h1>ANUNCIAR</h1>
        <p>
          Para anunciar um veículo, é necessário estar logado em sua conta. Se
          ainda não possui uma conta, por favor, registre-se.
        </p>
        <a href="login.html"><button>Fazer Login</button></a>
        <a href="register.html"><button>Registrar-se</button></a>
      </div>
    </section>
    <script>
     

      document
        .getElementById("carForm")
        .addEventListener("submit", function (event) {
          event.preventDefault(); // Impede o envio padrão do formulário

          const token = localStorage.getItem("token"); // Obtém o token do localStorage
          const formData = new FormData(this); // Cria um objeto FormData com os dados do formulário

          // Envia a requisição POST para o servidor
          fetch("http://localhost:4200/cars", {
            method: "POST",
            headers: {
              Authorization: `Bearer ${token}`, // Adiciona o token ao cabeçalho de autorização
            },
            body: formData, // Inclui o FormData no corpo da requisição
          })
            .then((response) => response.json())
            .then((data) => {
              if (data && data._id) {
                alert("Anúncio criado com sucesso!");
              } else {
                alert("Erro ao criar o anúncio: " + data.msg);
              }
            })
            .catch((error) => {
              console.error("Erro:", error);
              alert("Ocorreu um erro ao tentar criar o anúncio.");
            });
        });
    </script>
    <script src="core/app.js"></script>
  </body>
</html>
